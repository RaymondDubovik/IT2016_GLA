{% extends 'pitchify/base.html' %}

{% load staticfiles %}
{% load app_filters %}

{% block title %}My Pitches{% endblock %}

{% block styles %}
    <link href="{% static 'css/bootstrap-dialog.css' %} " rel="stylesheet">
    <link href="{% static 'css/investor_pitch.css' %} " rel="stylesheet">
{% endblock %}


{% block scripts %}
    <script src="{% static 'js/bootstrap-dialog.js' %} "></script>
    <script src="{% static 'js/investor_pitch.js' %} "></script>
{% endblock %}


{% block body_block %}
    <div class="indexInfo">
        <div class="container" id="main-container">
            <div class="display-table">

                <div id="pitch-main">
                    <div class="display-cell">
                        <div class="display-cell">
                            <div>
                                <iframe class="block center" width="560" height="315" src="https://www.youtube.com/embed/{{ pitch.youtube_video_id }}" frameborder="0" allowfullscreen></iframe>
                            </div>

                            <div class="div-margined display-table full-width">
                                <div class="display-cell vertical-middle">
                                    <span class="text" style="">{{ pitch.company.user.username }}</span>
                                </div>

                                <div class="pull-right progressbar-container display-table">
                                    <div class="text" id="stocks">{{ pitch.sold_stocks }} / {{ pitch.total_stocks}} stocks bought</div>
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width:{{ percentage_claimed }}%">
                                            {{ percentage_claimed }}%
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="div-margined">
                                <span class="text" id="description">{{ pitch.description }}</span>
                            </div>

                            <div class="div-margined">
                                {% for offer in offers %}
                                    <div id="offer_{{ offer.id }}" class="alert alert-{% if offer.status == offer.PENDING %}info{% elif offer.status == Offer.ACCEPTED %}success{% else %}danger{% endif %}">
                                        <div class="text-left">
                                            <div class="full-width ">
                                                <p>
                                                    <span> {{ offer.stock_count }} stocks for {{ offer.price }}£</span>
                                                    <span class="float-right">{{ Offer.STATUS_CHOICES|get_offer_status:offer.status }}{% if offer.status == offer.PENDING %} <a href="#" onClick="removeOffer({{ offer.id }})">(Delete)</a>{% endif %}</span>
                                                </p>
                                            </div>

                                            <p>{{ offer.message }}</p>
                                            {% if offer.status != offer.PENDING %}
                                                <p>Answer: {{ offer.answer }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <div id="top-pitches">
                    <div><h3 class="text">Top pitches</h3></div>
                    {% for pitch in top_pitches %}
                        <div class="div-margined display-table">
                            <div class="display-cell">
                                <img class="pitch-image" src="http://img.youtube.com/vi/{{ pitch.youtube_video_id }}/0.jpg" />
                            </div>
                            <div class="text display-cell vertical-top top-pitch">
                                <div>{{ pitch.title }}</div>
                                <div>Invested {{ pitch.invested }}£</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}